











<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html id="top" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>
    RSF Wiki: SellItemSWFSample
  </title>
  











<link rel="stylesheet" media="screen, projection, print" type="text/css"
     href="templates/default/jspwiki.css"/>

<link rel="stylesheet" type="text/css" media="print" 
     href="templates/default/jspwiki_print.css" />
<!-- INCLUDERESOURCES (stylesheet) -->

<!-- INCLUDERESOURCES (inlinecss) -->



<noscript>
<style type="text/css">
#hiddenmorepopup { display:block; }
</style>
</noscript>


<script type="text/javascript" src="scripts/mootools.js"></script>
<script type="text/javascript" src="scripts/prettify.js"></script>
<script type="text/javascript" src="scripts/jspwiki-common.js"></script>
<script type="text/javascript" src="scripts/jspwiki-commonstyles.js"></script>
<!-- INCLUDERESOURCES (script) -->





<meta name="wikiContext" content='view' />
<meta name="wikiBaseUrl" content='http://rsf.fluidproject.org/wiki/' />
<meta name="wikiPageUrl" content='/wiki/Wiki.jsp?page=%23%24%25' />
<meta name="wikiEditUrl" content='/wiki/Edit.jsp?page=SellItemSWFSample' />
<meta name="wikiJsonUrl" content='/wiki/JSON-RPC' />
<meta name="wikiPageName" content='SellItemSWFSample' />
<meta name="wikiUserName" content='205.211.169.35' />
<meta name="wikiTemplateUrl" content='/wiki/templates/default/' />
<meta name="wikiApplicationName" content='RSF Wiki' />

<script type="text/javascript">//<![CDATA[
/* Localized javascript strings: LocalizedStrings[] */
var LocalizedStrings = {
"javascript.edit.allsections":"( All )",
"javascript.slimbox.error":"<h2>Error</h2>There was a problem with your request.<br />Please try again",
"javascript.slimbox.remoteRequest":"Remote Request {0} of {1}",
"javascript.slimbox.close":"Close &#215;",
"javascript.quick.edit":"[Edit]",
"javascript.sort.descending":"Descending order. Click to reverse sort order",
"javascript.expand":"Click to expand",
"javascript.group.validName":"Please provide a valid name for the new Group",
"javascript.slimbox.next":"Next&raquo;",
"javascript.filter.all":"( All )",
"javascript.edit.areyousure":"Without clicking the Save button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.quick.edit.title":"Edit section {0}...",
"javascript.slimbox.directLink":"Direct Link to the target",
"javascript.prefs.areyousure":"Without clicking the Save User Preferences button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.sbox.clone.suffix":"-New",
"javascript.slimbox.info":"Image {0} of {1}",
"javascript.tip.default.title":"More...",
"javascript.edit.resize":"Drag to resize the text area",
"javascript.edit.findandreplace.nomatch":"No match found!",
"javascript.sort.ascending":"Ascending order. Click to reverse sort order",
"javascript.slimbox.close.title":"Close [Esc]",
"javascript.edit.toolbar.makeSelection":"Please make first a selection.",
"javascript.favs.hide":"Click to hide Favorites",
"javascript.sectionediting.label":"Section Overview",
"javascript.slimbox.previous":"&laquo;Previous",
"javascript.favs.show":"Click to show Favorites",
"javascript.collapse":"Click to collapse",
"javascript.category.title":"Click to show category [{0}] ...",
"javascript.sort.click":"Click to sort",
"javascript.edit.startOfPage":"( Start of page )"
};


/* INCLUDERESOURCES (jsfunction) */

//]]></script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="search" href="Wiki.jsp%3Fpage=FindPage.html"
    title='Search RSF Wiki' />
<link rel="help"   href="Wiki.jsp%3Fpage=TextFormattingRules.html"
    title="Help" />

 <link rel="start"  href="Wiki.jsp%3Fpage=Main.html"
    title="Front page" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki_print.css"
    title="Print friendly" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki.css"
    title="Standard" />
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

<link rel="icon" type="image/x-icon" href="images/favicon.ico" />



  









  
  
  
</head>

<body class="view">

<div id="wikibody" class="fav-left">
 
  






<div id="header">

  <div class="titlebox"></div>

  <div class="applicationlogo" > 
    <a href="Wiki.jsp%3Fpage=Main.html"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login.jsp%3Fredirect=SellItemSWFSample.html" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences.jsp%3Fredirect=SellItemSWFSample.html"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>

  <div class="pagename">SellItemSWFSample</div>

  <div class="searchbox">






<form action="http://xen0.idrc.ocadu.ca/wiki/Search.jsp"
        class="wikiform"
           id="searchForm" accept-charset="UTF-8">

  <div style="position:relative">
  <input onblur="if( this.value == '' ) { this.value = this.defaultValue }; return true; "
        onfocus="if( this.value == this.defaultValue ) { this.value = ''}; return true; "
           type="text" value="Quick Navigation"
           name="query" id="query"
           size="20" 
      accesskey="f" />
  <button type="submit"
  		 name="searchSubmit" id="searchSubmit"
  		value="Go!"
  		title="Go!"></button>
  </div>
  <div id="searchboxMenu" style='visibility:hidden;'>
    <div id="searchTools">
      <a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#" id='quickView' class='action'
      onclick="SearchBox.navigate( '/wiki/Wiki.jsp?page=__PAGEHERE__','View the selected page' );"
        title="View the selected page">view</a>
      <a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#" id='quickEdit' class='action'
      onclick="SearchBox.navigate( '/wiki/Edit.jsp?page=__PAGEHERE__','Edit the selected page' );"
        title="Edit the selected page">edit</a>
      <a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#" id='quickClone' class='action'	
      onclick="return SearchBox.navigate( '/wiki/Edit.jsp?page=__PAGEHERE__', 'Clone the selected page', true );"
        title="Clone the selected page">clone</a>
      <a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#" id="advancedSearch" class='action'
      onclick="SearchBox.navigate( 'http://rsf.fluidproject.org/wiki/Search.jsp?query=__PAGEHERE__','SellItemSWFSample' )"
        title="Advanced Search [ f ]">find</a>
    </div>
    <div id="searchResult" >
	  Quick search
      <span id="searchTarget" >(type ahead)</span>
      <span id="searchSpin" class="spin" style="position:absolute;display:none;"></span>
	  <div id="searchOutput" ></div>
    </div>
    <div id="recentSearches" style="display:none;">
      Recent Searches
      <span><a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#" id="recentClear">(Clear)</a></span>
    </div>
  </div>

</form></div>

  <div class="breadcrumbs">Your trail:&nbsp;<a class="wikipage" href="Wiki.jsp%3Fpage=PhonebookSWFSample.html">PhonebookSWFSample</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=RSFforSWF.html">RSFforSWF</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=TemplateCheckingTool.html">TemplateCheckingTool</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=HelloWorld.html">HelloWorld</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=LogonTest.html">LogonTest</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=EL.html">EL</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=ComponentTest.html">ComponentTest</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=SpringMVCStep.html">SpringMVCStep</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=HibernateCookBook.html">HibernateCookBook</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=NumberGuessing.html">NumberGuessing</a></div>

</div>

  <div id="content">

    <div id="page">
      





<div id="actionsTop" class="pageactions"> 
  <ul>

    
    
    

    
    <li id="morebutton">
      <a href="Wiki.jsp%3Fpage=MoreMenu.html" class="action more">More...</a>
    </li>

  </ul>
</div>

      








<div class="tabmenu">

  

  

  
  
  
    
  
    
  



  <a class="activetab" id="menu-pagecontent" accesskey="v" ><span class='accesskey'>V</span>iew</a>

  

  
  <a id="menu-attach" accesskey="a" ><span class='accesskey'>A</span>ttach</a>
  
    
  <a id="menu-info" href='PageInfo.jsp%3Fpage=SellItemSWFSample.html' accesskey="i" ><span class='accesskey'>I</span>nfo</a>
    
  

</div>
<div class="tabs">

  <div id="pagecontent" >

    











<p>On this page we will discuss more advanced integration issues for <a class="wikipage" href="Wiki.jsp%3Fpage=SWF.html">Spring Web Flow (SWF)</a> in <a class="wikipage" href="Wiki.jsp%3Fpage=RSF.html">RSF</a> in the context of the SWF &quot;Sell Item&quot; sample. This page is meant for those who are familiar with SWF and RSF. if you are new to either one you should start on the <a class="wikipage" href="Wiki.jsp%3Fpage=RSFSpringWebFlow.html">RSF-SpringWebFlow</a> page.
</p><p />
<table class="wikitable" border="1"><tr class="odd"><th> <b>Sample Code (SVN):</b> </th><td> <a class="external" href="https://source.caret.cam.ac.uk/rsf/projects/RSFSamples/trunk/SWFSellItem/orig">original code (with maven2 build)</a><img class="outlink" src="images/out.png" alt="" /> </td><td> <a class="external" href="https://source.caret.cam.ac.uk/rsf/projects/RSFSamples/trunk/SWFSellItem/RSFSWF">RSF SWF version</a><img class="outlink" src="images/out.png" alt="" /></td></tr>
</table><br />
<a class="external" href="http://ponder.org.uk/SWFSellItem-RSFSWF/faces">Try out Sell Item RSF SWF on our server</a><img class="outlink" src="images/out.png" alt="" />
<h3 id="section-SellItemSWFSample-PortingTheSWFSellItemSampleApplication"> Porting the SWF SellItem Sample Application<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-PortingTheSWFSellItemSampleApplication">#</a></h3>
<ul><li><a class="wikipage" href="Wiki.jsp%3Fpage=PortingSellItemSWFSampleToRSF.html">Porting the SellItem application is covered on its own page</a>, please read that page for information about the sample app and where to get the source that will be referred to below.
</li></ul><h3 id="section-SellItemSWFSample-AdvancedIssues"> Advanced issues<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-AdvancedIssues">#</a></h3>
Having dealt with the basic mechanics and concepts of RSF-SWF in the above two pages, on this page we will consider some more advanced issues.
<ul><li>RSF Courtesies to SWF Developers - two slightly different behaviours of RSF-SWF apps to plain SWF apps by default, that arguably result in a better user experience. These are automatic error redirects, and refreshable flow end states.
</li><li>Binding states within flows - &quot;JSF-style&quot; flows such as those in SellItem-JSF must omit binding steps since these are handled by the framework. RSF-SWF supports these kinds of flows as well as the JSP/SpringMVC style where the binding is performed by Spring Web Flow itself.
</li></ul><p>Here we will just look at some of the more interesting application points which the SellItem app specifically brings up, which are mainly related to form bindings and submissions.
</p>
<h3 id="section-SellItemSWFSample-FormSubmissionBindingsInRSFSWF">Form submission bindings in RSF-SWF<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-FormSubmissionBindingsInRSFSWF">#</a></h3>
RSF supplies a standard framework bean <tt>SWFBindingBean</tt> which acts as a proxy for RSF's <a class="wikipage" href="Wiki.jsp%3Fpage=EL.html">EL</a> bindings for &quot;whichever bean is the current submission target in the current SWF flow&quot;. By selecting the SWFBindingBean, we pass incoming request data through SWF's (Spring Web) binding system, typically based around the <tt>FormAction</tt> class, as well as any outgoing data for rendering passing through the PropertyEditor system on the way out.
<p>In the <a class="wikipage" href="Wiki.jsp%3Fpage=PhonebookSWFSample.html">phonebook sample</a>, we rendered a simple form with two fields as follows, in our producer:
</p>
<pre>
    UIForm form = UIForm.make(tofill, &quot;search-form&quot;);
    UIInput.make(form, &quot;first-name&quot;, &quot;SWFBindingBean.firstName&quot;);
    UIInput.make(form, &quot;last-name&quot;, &quot;SWFBindingBean.lastName&quot;);
    UICommand.make(form, &quot;submit&quot;, &quot;SWFEventBean.search&quot;);
</pre>
<p>In the SellItem sample, things are more varied. For user input, there is little choice, since we need to pass through SWF bindings. However, for output, sometimes the JSP views pass through the binding system using a tag such as the one below (from <tt>costOverview.jsp</tt>:
</p>
<pre>
&lt;spring:bind path=&quot;sale.shipDate&quot;&gt;
  ${status.value}
&lt;/spring:bind&gt;
</pre>
<p>At other times, the flow-scoped bean value is addressed directly, like this:
</p>
<pre>
&lt;td&gt;Type:&lt;/td&gt;
&lt;td&gt;${sale.shippingType}&lt;/td&gt;
</pre>
<p>This is a prime example of coupling between the template structure and application logic, since in this case, the reason for the difference is that the developer <i>knows</i> that the date property has to be converted for rendering using the <tt>CustomDateEditor</tt> we registered, whereas the <tt>shippingType</tt> property requires no conversion.
</p>
<p>However, since we are porting this app completely faithfully, the RSF version needs to reflect this difference in binding behaviour. In the RSF version, it is no longer visible at the templating layer, but <i>is</i> visible in the choice of bindings we issue in the producer. The above two JSP tags are both rendered the same in HTML, as a straight <tt>&lt;td&gt;</tt> tag, but in the producer <tt>CostOverviewProducer.java</tt>, they are rendered respectively as
</p>
<pre>
  UIOutput.make(tofill, &quot;sale-shippingType&quot;, null, &quot;sale.shippingType&quot;);
  UIOutput.make(tofill, &quot;sale-shipDate&quot;, null, &quot;SWFBindingBean.shipDate&quot;);
</pre>
<p>This distinction is actually less intrusive at the code level than it was in the original JSP, since it just amounts to a different binding path in a String. Other than this, there are no real extra issues raised within the <i>code</i> of our port of SellItem. It is filled with <a class="wikipage" href="Wiki.jsp%3Fpage=PrimitiveComponents.html">UIForm</a>s, UIInternalLinks and <a class="wikipage" href="Wiki.jsp%3Fpage=UISelect.html">UISelect</a>s bound to EL paths, like any other RSF app - all the SWF flow definitions &quot;just work&quot;. However, there <i>is</i> a new issue raised by the behaviour of the app, particular as the flow ends in the <tt>costOverview</tt> view - this is discussed towards the bottom of the page in the section on &quot;courtesies&quot;.
</p>
<p>This binding issue is much more interesting as we now turn to porting the JSF version of this SellItem sample, &quot;SellItem-JSF&quot;, directly to RSF-SWF - that is, we will remove JSF as the view technology for this sample, and port its template and flow definition to an RSF-SWF app like the one we have just looked at. Interestingly, the app behaves almost identically to SellItem-RSF-SWF, but it is not written quite the same way.
</p>
<h3 id="section-SellItemSWFSample-PortingSellItemJSF"> Porting SellItem-JSF<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-PortingSellItemJSF">#</a></h3>
<p>Our port to RSF-SWF is held in SVN at <a class="external" href="https://source.caret.cam.ac.uk/rsf/projects/RSFSamples/trunk/SWFSellItem/JSF-RSFSWF">SWFSellItem-JSF-RSFSWF</a><img class="outlink" src="images/out.png" alt="" />
</p>
<p>The crucial difference between SellItem and SellItem-JSF lies in the flow definition.
</p>
<p>In the JSF environment, to be a first-class framework citizen, we must use the JSF standard binding and validation phases for processing incoming form inputs through the JSF component tree. Therefore we cannot use the standard SWF <tt>FormAction</tt> system for data binding. For example, the first flow state in the &quot;simple&quot; JSP version of the SellItem flow <tt>sellitem-simple-flow.xml</tt> looks like this:
</p>
<pre>
&lt;view-state id=&quot;enterPriceAndItemCount&quot; view=&quot;priceAndItemCountForm&quot;&gt;
  &lt;render-actions&gt;
    &lt;action bean=&quot;formAction&quot; method=&quot;setupForm&quot;/&gt;
  &lt;/render-actions&gt;	
  &lt;transition on=&quot;submit&quot; to=&quot;enterCategory&quot;&gt;
    &lt;action bean=&quot;formAction&quot; method=&quot;bindAndValidate&quot;&gt;
      &lt;attribute name=&quot;validatorMethod&quot; value=&quot;validatePriceAndItemCount&quot;/&gt;
    &lt;/action&gt;
  &lt;/transition&gt;
&lt;/view-state&gt;
</pre>
<p>However, the initial state in the JSF flow is much more simple, since the data binding must be handled by the JSF framework itself:
</p>
<pre>
&lt;view-state id=&quot;enterPriceAndItemCount&quot; view=&quot;/priceAndItemCountForm.jsp&quot;&gt;
  &lt;transition on=&quot;submit&quot; to=&quot;enterCategory&quot;/&gt;
&lt;/view-state&gt;
</pre>
<p>RSF also allows flows of this sort to be hosted directly in RSF-SWF without changes. Note that to start with, RSF-SWF will automatically strip off the leading <tt>/</tt> and any file extension from view names that it encounters in flow files in order to arrive at an RSF <a class="wikipage" href="Wiki.jsp%3Fpage=ViewID.html">ViewID</a>.
</p>
<p>Our main task here is translate each of the SWF environmental elements into their RSF equivalents. For the most part, these simply translate into swapping the <tt>SWFBindingBean</tt> prefix on each of our input elements to use <tt>sale</tt> - this will direct RSF's data binding apparatus to process the incoming submissions, rather than SWF's <tt>FormAction</tt>. However, there are two special application elements we will need to handle separately - the <b>validator</b>, used for checking the price and item count greater than 0, and the <b>property editor</b> used for converting the shipping date field to and from textual form.
</p>
<div style="text-align:center">
<img class="inline" src="attach/ImageHolder/swfsellitem-jsf-rsf.png" alt="ImageHolder/swfsellitem-jsf-rsf.png" />
</div>
<h3 id="section-SellItemSWFSample-StartingWithAPOST"> Starting with a POST<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-StartingWithAPOST">#</a></h3>
One detail we have not seen in our other sample apps is how to start a flow with a POST submission rather than a GET link. This is fairly straightforward and follows the standard RSF pattern of a <a class="wikipage" href="Wiki.jsp%3Fpage=UICommand.html">UICommand</a> together with a <a class="wikipage" href="Wiki.jsp%3Fpage=NavigationCase.html">NavigationCase</a> rule - here is the code from <tt>IndexProducer</tt>:
<pre>
 public void fillComponents(UIContainer tofill, ViewParameters viewparams,
      ComponentChecker checker) {
    // the original two ways of launching the JSF flow - via POST or GET
    UIForm form = UIForm.make(tofill, &quot;jsf-launch-form&quot;);
    UICommand.make(form, &quot;submit&quot;);
    UIInternalLink.make(tofill, &quot;sellitem-jsf-flow-link&quot;, 
      new SWFLaunchViewParams(&quot;sellitem-jsf-flow&quot;));
  }

  public List&lt;NavigationCase&gt; reportNavigationCases() {
    List&lt;NavigationCase&gt; togo = new ArrayList&lt;NavigationCase&gt;();
    togo.add(new NavigationCase(new SWFLaunchViewParams(&quot;sellitem-jsf-flow&quot;)));
    return togo;
  }
</pre>
<p>Actually though we &quot;say&quot; that the JSF view would start with a link, since all JSF transitions are in fact POSTs, this flexibility was a bit illusory. In the RSF version the transitions genuinely are GET and POST respectively, although by SWF requirements, both of these flow starts would be immediately followed by a client redirect.
</p>
<h3 id="section-SellItemSWFSample-Validator"> Validator<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-Validator">#</a></h3>
In the JSF version of this app, rather than the self-contained Spring Validator, the validation rule was written in a fairly &quot;ad hoc&quot; way into the template itself:
<pre>
  &lt;h:inputText id=&quot;price&quot; value=&quot;#{sale.price}&quot; required=&quot;true&quot;&gt;
    &lt;f:validateDoubleRange minimum=&quot;0.01&quot;/&gt;
  &lt;/h:inputText&gt;
</pre>
<pre>
  &lt;h:inputText id=&quot;itemCount&quot; value=&quot;#{sale.itemCount}&quot; required=&quot;true&quot;&gt;
    &lt;f:validateLongRange minimum=&quot;1&quot;/&gt;
  &lt;/h:inputText&gt;
</pre>
<p>The good news in RSF-SWF is that we can use the original Spring validator from the non-JSF version of the app directly. Since it is not part of the flow definition now, however, we must register it with RSF against the request context <i>in general</i> rather than acting as part of the flow. This is done in RSF via a <a class="wikipage" href="Wiki.jsp%3Fpage=BeanGuards.html">BeanGuard</a> declaration, an application scope Spring definition that specifies a declarative rule to be triggered on any data access matching a path rule:
</p>
<pre>
  &lt;bean parent=&quot;writeGuardParent&quot;&gt;
    &lt;property name=&quot;guard&quot;&gt;
      &lt;bean class=&quot;org.springframework.webflow.samples.sellitem.SaleValidator&quot;/&gt;
    &lt;/property&gt;
    &lt;property name=&quot;guardedPath&quot; value=&quot;sale&quot;/&gt;
  &lt;/bean&gt;
</pre>
<p>Note that the *location* of the guarded path itself is still determined within the flow - <tt>sale</tt> is still a flow-scoped variable, even though SWF has handed off all data conversion tasks to the outside framework. From <tt>sellitem-jsf-flow.xml</tt>:
</p>
<pre>
&lt;var name=&quot;sale&quot; class=&quot;org.springframework.webflow.samples.sellitem.Sale&quot; 
       scope=&quot;conversation&quot;/&gt;
</pre>
<p>Note that to free up this EL path for access over the request by RSF form submissions, we must explicitly declare it as <a class="wikipage" href="Wiki.jsp%3Fpage=RequestWriteableBean.html">request addressible</a>:
</p>
<pre>
  &lt;bean parent=&quot;requestAddressibleParent&quot;&gt;
    &lt;property name=&quot;value&quot; value=&quot;sale&quot;/&gt;
  &lt;/bean&gt;
</pre>
<h3 id="section-SellItemSWFSample-DateConverter"> Date converter<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-DateConverter">#</a></h3>
Again, since RSF is so closely aligned with Spring web fundamentals, we can also use the original <tt>CustomDateEditor</tt> converter that the non-JSF version of SellItem used. Very similarly to the validator, the converter is registered as a declarative rule against the <i>context in general</i> rather than scoped to a flow:
<pre>
  &lt;bean class=&quot;uk.org.ponder.mapping.DataConverter&quot;&gt;
    &lt;property name=&quot;targetPath&quot; value=&quot;sale.shipDate&quot; /&gt;
    &lt;property name=&quot;converter&quot;&gt;
      &lt;bean class=&quot;org.springframework.webflow.samples.sellitem.rsf.DateEditorFactory&quot; /&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
</pre>
<p>This specifies that any read or write access (via EL) to the path <tt>sale.shipDate</tt> in the context must first pass through our Date converter. Again, whilst we can use the same <i>converter</i>, we can't actually use the Spring packaging via the <tt>PropertyEditorRegistrar</tt> system, since the requirements of the RSF environment and form submission process are slightly different. Instead we must deliver the <tt>PropertyEditor</tt> versus an RSF (or rather PUC) <tt>PropertyEditorFactory</tt>:
</p>
<pre>
public class DateEditorFactory implements PropertyEditorFactory {
  public PropertyEditor getPropertyEditor() {
    return new CustomDateEditor(new SimpleDateFormat(&quot;dd/MM/yyyy&quot;), true);
  }
}
</pre>
<p>Since this factory is a standard Spring bean, it would be easy to transfer <tt>PropertyEditors</tt> from another part of the context, if there were a centralised pool of them, by injection. As well as <tt>javax.beans</tt> <tt>PropertyEditors</tt>, other options for data conversion within RSF include <tt>LeafObjectParser</tt>, <tt>DARReshaper</tt> and <tt>BeanResolver</tt>, as well as the use of <a class="wikipage" href="Wiki.jsp%3Fpage=TransitBeans.html">Transit beans</a> for more complex data transformation requirements (in general, where the conversion multiplicity is not 1-1, but for example where we are focusing 3 values onto 1, or splitting 1 into 3, as you might for a field-based date control). An even better way of managing this date input within RSF is use of the standard date widget, part of the <a class="wikipage" href="Wiki.jsp%3Fpage=RSFComponents.html">RSFComponents</a> package - this is presented a little on the <a class="wikipage" href="Wiki.jsp%3Fpage=BuildingRSFComponents.html">BuildingRSFComponents</a> page. The date widget is fully internationalised, injecting the server-side locale down to the client side, as well as being vetted for accessibility and usability, shortly to become shepherded by the <a class="external" href="http://www.fluidproject.org/">Fluid UI Project</a><img class="outlink" src="images/out.png" alt="" />. This widget would be usable equally in an RSF-SWF, RSF-&quot;JSF&quot;-SWF or straight RSF app just with a change of EL bindings.
</p>
<p>The only behavioural difference between the original SWF-JSF sample and the SWF-SpringMVC-JSP is that in the original JSF version, the date input field is left out entirely.
</p>
<p>The SellItem-JSF-SWFRSF and SellItem-SWFRSF apps behave identically from the user perspective in our ports.
</p>
<h3 id="section-SellItemSWFSample-FurtherUniversalPortability"> Further universal portability<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-FurtherUniversalPortability">#</a></h3>
Inside SellItem-JSF-RSFSWF there is some &quot;demonstration&quot; code to illustrate a strategy that could be used for housing <i>both</i> of the kinds of SWF flows for SellItem (both &quot;straight&quot; and &quot;JSF&quot; versions) within the same app, and targetting them at the <i>same</i> set of RSF producers. This code is currently inactivated for clarity of explanation. It consists of a core factory bean, &quot;BindingComputer&quot;, that introspects into the currently executing flow, and returns the binding base String <tt>SWFBindingBean</tt> if it is one of the straight flows, else <tt>sale</tt> for the JSF flow. This String is transferred to a request-scope variable via a <tt>factory-method</tt>, and could then be injected &quot;in bulk&quot; into all the producers by deriving them from a Spring parent definition:
<pre>
  &lt;bean id=&quot;bindingComputer&quot; 
      class=&quot;org.springframework.webflow.samples.sellitem.rsf.BindingComputer&quot;&gt;
    &lt;property name=&quot;viewParameters&quot; ref=&quot;parsedViewParameters&quot;/&gt;
    &lt;property name=&quot;flowExecutor&quot; ref=&quot;flowExecutor&quot; /&gt;
    &lt;property name=&quot;externalContext&quot; ref=&quot;SWFExternalContext&quot;/&gt;
  &lt;/bean&gt;
  
  &lt;bean id=&quot;bindingBase&quot; factory-bean=&quot;bindingComputer&quot; factory-method=&quot;getBindingBase&quot;/&gt;
  
  &lt;bean abstract=&quot;true&quot; id=&quot;producerBase&quot; 
      class=&quot;org.springframework.webflow.samples.sellitem.rsf.producers.ProducerBase&quot;&gt;
    &lt;property name=&quot;bindingBase&quot; ref=&quot;bindingBase&quot;/&gt;
  &lt;/bean&gt;
</pre>
<p><tt>ProducerBase</tt> then makes available convenient utility methods for producer code <tt>getBinding</tt> and <tt>makeSaleOutputs</tt> which automatically targets its products against the appropriate path for the current flow, depending on whether the SWF or RSF binding system is required. This is a little esoteric, but demonstrates the enormous power of Spring-style development to deliver portable, environment-independent code, which can be fully realised within RSF. Binding parameterisation is a powerful means for gaining reusability for RSF producers, by enabling them to be targetted at any variety of bean targets.
</p>
<h3 id="section-SellItemSWFSample-RSFCourtesiesToSWFDevelopers"> RSF Courtesies to SWF Developers<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-RSFCourtesiesToSWFDevelopers">#</a></h3>
<p>After playing around with the RSF-SWF versions of these samples, you may notice that although the application behaviour is essentially identical, there are a couple of differences in behaviour, primarily in error cases. 
</p>
<h4 id="section-SellItemSWFSample-AutomaticErrorRedirects"> Automatic error redirects <a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-AutomaticErrorRedirects">#</a></h4>
The most obvious behaviour is on entering an expired or invalid flow URL, either by using the back button or by entering an incomplete or invalid flowId/Token. The default behaviour on JSP/SpringMVC is to render a stack trace to the browser, whereas the default RSF behaviour, under the <a class="wikipage" href="Wiki.jsp%3Fpage=Level1Error.html">Level1Error</a> system, is to redirect to the default view. In both frameworks these defaults are easy to configure differently, but it is arguable that the RSF behaviour is more useful and pleasant to users &quot;out of the box&quot;. This is a general RSF default and not specific to the RSF-SWF integration.
<h4 id="section-SellItemSWFSample-RefreshableEndFlowView"> Refreshable end flow view<a class="hashlink" href="Wiki.jsp%3Fpage=SellItemSWFSample.html#section-SellItemSWFSample-RefreshableEndFlowView">#</a></h4>
A more subtle issue is to do with the URL and server environment as a SWF flow ends. By default, the SWF flow end is somewhat brutally abrupt - the flow technically ends <i>partway</i> through the processing of the final POST request, and in the Sell Item application, for example, if we require to render data which depends on flow variables, we must rely on these being &quot;resurrected&quot; very briefly out of the flow by a <tt>FormAction</tt> <tt>setupForm</tt> action happening on entry to the end flow state. By the time rendering occurs, the flow itself is already expired and all flow variables deallocated.
<pre>
&lt;end-state id=&quot;finish&quot; view=&quot;costOverview&quot;&gt;
	&lt;entry-actions&gt;
		&lt;action bean=&quot;formAction&quot; method=&quot;setupForm&quot;/&gt;
	&lt;/entry-actions&gt;
&lt;/end-state&gt;
</pre>
<p>There is not even time to perform a standard &quot;POST-to-GET&quot; redirect on this step.
</p>
<p>The result of this behaviour is that if the user hits the refresh button on this final view, they will receive an error message rather than the page refresh they are expecting. This could be undesirably brittle, especially considering the fact that a network error or some other failure may prevent the user seeing the initial rendering attempt at the end flow state.
</p>
<p>By default, RSF provides more robust behaviour on flow end, at the cost of a little server state - an RSF &quot;<a class="wikipage" href="Wiki.jsp%3Fpage=Flows.html">flow</a> end state&quot; is glued on to the end of an SWF flow end, to provide a small URL environment where the view may be refreshed by the user for a while, even whilst the flow proper has expired.
</p>






        
  </div>


  

  
  <div id="attach" class="hidetab" >

    










<div id="addattachment">
<h3>Add new attachment</h3>


<div class="formhelp">Only authorized users are allowed to upload new attachments.</div>

</div>



  </div>

  
    
  <div id="info" class="hidetab" >

  </div>

    
  

<div style="clear:both;" ></div>
</div>

      







<div id='actionsBottom' class="pageactions"> 
    

    <a href="Wiki.jsp%3Fpage=SellItemSWFSample.html#top" 
      class="action quick2top" 
      title="Go to top" >&laquo;</a>

    
       This page (revision-) was last changed on <a href="Diff.jsp%3Fpage=SellItemSWFSample&amp;r1=-1&amp;r2=1.html">10-Sep-2008 21:35</a> by UnknownAuthor
    

    

   

  

   
</div>

    </div>

    






<div id="favorites">

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login.jsp%3Fredirect=SellItemSWFSample.html" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences.jsp%3Fredirect=SellItemSWFSample.html"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>
  
  <div id="hiddenmorepopup">
  <ul id="morepopup">
     
       	
     
       
     
    
       
     
       <li>
       
       <a class="action rawpage wikipage" 
               href="Wiki.jsp%3Fpage=SellItemSWFSample&amp;skin=raw.html"
              title="View Page Source">View Page Source
       </a>
       
       
       </li>
      
        
  
      
      
      

      
	  <li class='separator'>
        <div id="moremenu" ></div>
      </li>
  </ul>
  </div>
  
  

  

  

  
  <div class="leftmenu">
    <p><a class="wikipage" href="Wiki.jsp%3Fpage=Main.html">Main page</a><br />
<tt> </tt><i><a class="wikipage" href="Wiki.jsp%3Fpage=ThisWiki.html">About</a></i><br />
</p><p><a class="wikipage" href="Wiki.jsp%3Fpage=GettingStarted.html">Getting Started</a><br />
</p>
<p><b>Documentation</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Developers.html">Developers</a><br />
<tt>  </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Javadocs.html">Javadocs</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Designers.html">Designers</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=SampleRSFApps.html">Sample RSF Apps</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Presentations.html">Presentations</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Acronyms.html">Acronyms</a><br />
</p>
<p><b>Downloads</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Downloads.html">Current Release</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=TrunkCode.html">Trunk</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=CodeDistributions.html">Distributions</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=OldCode.html">Old Versions</a><br />
</p>
<p><b>Community</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=QampA.html">Q&amp;A</a><br />
<tt> </tt><a class="external" href="http://ponder.org.uk/rsf/">Forums</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=EmailLists.html">Mailing Lists</a><br />
<tt> </tt><a class="external" href="http://www.caret.cam.ac.uk/jira/browse/RSF">Issue Tracker</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=azeckoski.html">People</a><br />
</p>
<p><b>Design</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Roadmap.html">Roadmap</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Integrations.html">Integrations</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Concepts.html">Concepts</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Philosophy.html">Philosophy</a><br />
</p>
<div style="font-style:italic;font-size:0.8em;">
<b>Pages</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=FindPage.html">Find</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=RecentChanges.html">Recent Changes</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=UnusedPages.html">Unused</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=UndefinedPages.html">Undefined</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=PageIndex.html">Index</a>
</div>
<p />
    
  </div>
  
  <div class="leftmenufooter">
    <hr />
<p><b>Referenced by</b><br />
<a class="wikipage" href="Wiki.jsp%3Fpage=PhonebookSWFSample.html">PhonebookSWFSample</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=RSFSpringWebFlow.html">RSFSpringWebFlow</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=RSFforSWF.html">RSFforSWF</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=SampleRSFApps.html">SampleRSFApps</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=SWF.html">SpringWebFlow</a><br />
</p>
    
  </div>

  

  
  
  <div class="wikiversion">JSPWiki v2.8.2
  <span class="rssfeed">
    
  </span>
  </div>  
  
</div>

	<div class="clearbox"></div>
  </div>

  





 
<div id="footer">

  <div class="applicationlogo" > 
    <a href="Wiki.jsp%3Fpage=Main.html"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  <div class="copyright"></div>

  <div class="wikiversion">
    JSPWiki v2.8.2
  </div>

  <div class="rssfeed">
    
  </div>

</div>

</div>

</body>
</html>

