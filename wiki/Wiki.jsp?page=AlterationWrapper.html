











<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html id="top" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>
    RSF Wiki: AlterationWrapper
  </title>
  











<link rel="stylesheet" media="screen, projection, print" type="text/css"
     href="templates/default/jspwiki.css"/>

<link rel="stylesheet" type="text/css" media="print" 
     href="templates/default/jspwiki_print.css" />
<!-- INCLUDERESOURCES (stylesheet) -->

<!-- INCLUDERESOURCES (inlinecss) -->



<noscript>
<style type="text/css">
#hiddenmorepopup { display:block; }
</style>
</noscript>


<script type="text/javascript" src="scripts/mootools.js"></script>
<script type="text/javascript" src="scripts/prettify.js"></script>
<script type="text/javascript" src="scripts/jspwiki-common.js"></script>
<script type="text/javascript" src="scripts/jspwiki-commonstyles.js"></script>
<!-- INCLUDERESOURCES (script) -->





<meta name="wikiContext" content='view' />
<meta name="wikiBaseUrl" content='http://rsf.fluidproject.org/wiki/' />
<meta name="wikiPageUrl" content='/wiki/Wiki.jsp?page=%23%24%25' />
<meta name="wikiEditUrl" content='/wiki/Edit.jsp?page=AlterationWrapper' />
<meta name="wikiJsonUrl" content='/wiki/JSON-RPC' />
<meta name="wikiPageName" content='AlterationWrapper' />
<meta name="wikiUserName" content='205.211.169.35' />
<meta name="wikiTemplateUrl" content='/wiki/templates/default/' />
<meta name="wikiApplicationName" content='RSF Wiki' />

<script type="text/javascript">//<![CDATA[
/* Localized javascript strings: LocalizedStrings[] */
var LocalizedStrings = {
"javascript.edit.allsections":"( All )",
"javascript.slimbox.error":"<h2>Error</h2>There was a problem with your request.<br />Please try again",
"javascript.slimbox.remoteRequest":"Remote Request {0} of {1}",
"javascript.slimbox.close":"Close &#215;",
"javascript.quick.edit":"[Edit]",
"javascript.sort.descending":"Descending order. Click to reverse sort order",
"javascript.expand":"Click to expand",
"javascript.group.validName":"Please provide a valid name for the new Group",
"javascript.slimbox.next":"Next&raquo;",
"javascript.filter.all":"( All )",
"javascript.edit.areyousure":"Without clicking the Save button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.quick.edit.title":"Edit section {0}...",
"javascript.slimbox.directLink":"Direct Link to the target",
"javascript.prefs.areyousure":"Without clicking the Save User Preferences button, your changes will be lost. Are you sure you want to exit this page?",
"javascript.sbox.clone.suffix":"-New",
"javascript.slimbox.info":"Image {0} of {1}",
"javascript.tip.default.title":"More...",
"javascript.edit.resize":"Drag to resize the text area",
"javascript.edit.findandreplace.nomatch":"No match found!",
"javascript.sort.ascending":"Ascending order. Click to reverse sort order",
"javascript.slimbox.close.title":"Close [Esc]",
"javascript.edit.toolbar.makeSelection":"Please make first a selection.",
"javascript.favs.hide":"Click to hide Favorites",
"javascript.sectionediting.label":"Section Overview",
"javascript.slimbox.previous":"&laquo;Previous",
"javascript.favs.show":"Click to show Favorites",
"javascript.collapse":"Click to collapse",
"javascript.category.title":"Click to show category [{0}] ...",
"javascript.sort.click":"Click to sort",
"javascript.edit.startOfPage":"( Start of page )"
};


/* INCLUDERESOURCES (jsfunction) */

//]]></script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="search" href="Wiki.jsp%3Fpage=FindPage.html"
    title='Search RSF Wiki' />
<link rel="help"   href="Wiki.jsp%3Fpage=TextFormattingRules.html"
    title="Help" />

 <link rel="start"  href="Wiki.jsp%3Fpage=Main.html"
    title="Front page" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki_print.css"
    title="Print friendly" />
<link rel="alternate stylesheet" type="text/css" href="templates/default/jspwiki.css"
    title="Standard" />
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />

<link rel="icon" type="image/x-icon" href="images/favicon.ico" />



  









  
  
  
</head>

<body class="view">

<div id="wikibody" class="fav-left">
 
  






<div id="header">

  <div class="titlebox"></div>

  <div class="applicationlogo" > 
    <a href="Wiki.jsp%3Fpage=Main.html"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login.jsp%3Fredirect=AlterationWrapper.html" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences.jsp%3Fredirect=AlterationWrapper.html"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>

  <div class="pagename">AlterationWrapper</div>

  <div class="searchbox">






<form action="http://xen0.idrc.ocadu.ca/wiki/Search.jsp"
        class="wikiform"
           id="searchForm" accept-charset="UTF-8">

  <div style="position:relative">
  <input onblur="if( this.value == '' ) { this.value = this.defaultValue }; return true; "
        onfocus="if( this.value == this.defaultValue ) { this.value = ''}; return true; "
           type="text" value="Quick Navigation"
           name="query" id="query"
           size="20" 
      accesskey="f" />
  <button type="submit"
  		 name="searchSubmit" id="searchSubmit"
  		value="Go!"
  		title="Go!"></button>
  </div>
  <div id="searchboxMenu" style='visibility:hidden;'>
    <div id="searchTools">
      <a href="Wiki.jsp%3Fpage=AlterationWrapper.html#" id='quickView' class='action'
      onclick="SearchBox.navigate( '/wiki/Wiki.jsp?page=__PAGEHERE__','View the selected page' );"
        title="View the selected page">view</a>
      <a href="Wiki.jsp%3Fpage=AlterationWrapper.html#" id='quickEdit' class='action'
      onclick="SearchBox.navigate( '/wiki/Edit.jsp?page=__PAGEHERE__','Edit the selected page' );"
        title="Edit the selected page">edit</a>
      <a href="Wiki.jsp%3Fpage=AlterationWrapper.html#" id='quickClone' class='action'	
      onclick="return SearchBox.navigate( '/wiki/Edit.jsp?page=__PAGEHERE__', 'Clone the selected page', true );"
        title="Clone the selected page">clone</a>
      <a href="Wiki.jsp%3Fpage=AlterationWrapper.html#" id="advancedSearch" class='action'
      onclick="SearchBox.navigate( 'http://rsf.fluidproject.org/wiki/Search.jsp?query=__PAGEHERE__','AlterationWrapper' )"
        title="Advanced Search [ f ]">find</a>
    </div>
    <div id="searchResult" >
	  Quick search
      <span id="searchTarget" >(type ahead)</span>
      <span id="searchSpin" class="spin" style="position:absolute;display:none;"></span>
	  <div id="searchOutput" ></div>
    </div>
    <div id="recentSearches" style="display:none;">
      Recent Searches
      <span><a href="Wiki.jsp%3Fpage=AlterationWrapper.html#" id="recentClear">(Clear)</a></span>
    </div>
  </div>

</form></div>

  <div class="breadcrumbs">Your trail:&nbsp;<a class="wikipage" href="Wiki.jsp%3Fpage=IDs.html">IDs</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=RequestWriteableBean.html">RequestWriteableBean</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=PrimitiveComponents.html">PrimitiveComponents</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=Decorators.html">Decorators</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=MessageLocator.html">MessageLocator</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=UIBranchContainer.html">UIBranchContainer</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=RSFComponents.html">RSFComponents</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=OLI.html">OLI</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=SeedComponent.html">SeedComponent</a>, <a class="wikipage" href="Wiki.jsp%3Fpage=HandlerHook.html">HandlerHook</a></div>

</div>

  <div id="content">

    <div id="page">
      





<div id="actionsTop" class="pageactions"> 
  <ul>

    
    
    

    
    <li id="morebutton">
      <a href="Wiki.jsp%3Fpage=MoreMenu.html" class="action more">More...</a>
    </li>

  </ul>
</div>

      








<div class="tabmenu">

  

  

  
  
  
    
  
    
  



  <a class="activetab" id="menu-pagecontent" accesskey="v" ><span class='accesskey'>V</span>iew</a>

  

  
  <a id="menu-attach" accesskey="a" ><span class='accesskey'>A</span>ttach</a>
  
    
  <a id="menu-info" href='PageInfo.jsp%3Fpage=AlterationWrapper.html' accesskey="i" ><span class='accesskey'>I</span>nfo</a>
    
  

</div>
<div class="tabs">

  <div id="pagecontent" >

    











<p>An AlterationWrapper is an application scope bean which implements the <a class="wikipage" href="Wiki.jsp%3Fpage=RunnableInvoker.html">RunnableInvoker</a> interface, which is registered into RSF using the <tt>alterationWrapperParent</tt> parent definition. AlterationWrapper is a central part of the support of RSF for diverse ORM solutions such as <a class="external" href="http://www.hibernate.org">Hibernate</a><img class="outlink" src="images/out.png" alt="" /> since it enables the transaction, session and exception handling strategy of the webapp to be application defined. It is also useful for non-ORM purposes, where access to the model (or the main request phase in general) needs to be guarded by custom logic - see the <a class="wikipage" href="Wiki.jsp%3Fpage=LogonTest_3.html">LogonTest</a> sample program for an example of using the AlterationWrapper for security purposes.
</p><p>The RunnableInvoker interface is a great <a class="wikipage" href="Wiki.jsp%3Fpage=OLI.html">OLI</a> that looks like this:
</p>
<pre>
public interface RunnableInvoker {
  public void invokeRunnable(Runnable torun);
}
</pre>
<p>If <tt>MyAlterationWrapper</tt> is a class implementing <tt>RunnableInvoker</tt>, one would register it as an AlterationWrapper into RSF using a definition like this at application scope:
</p>
<pre>
  &lt;bean id=&quot;hibernateAlterationWrapperProxy&quot; parent=&quot;alterationWrapperParent&quot;&gt;
    &lt;property name=&quot;value&quot;&gt;
      &lt;bean class=&quot;MyAlterationWrapper&quot;&gt;
        .. dependencies here
      &lt;/bean&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
</pre>
If (as is quite likely) the wrapper is itself a request-scope bean, you would use an <a class="wikipage" href="Wiki.jsp%3Fpage=RSACBridgeProxy.html">RSACBridgeProxy</a> to wrap the reference to the wrapper in the place of the inner bean definition above - for example, where <tt>myRequestScopeBean</tt> is a bean at request scope implementing <tt>RunnableInvoker</tt>, 
<pre>
  &lt;bean parent=&quot;alterationWrapperParent&quot;&gt;
    &lt;property name=&quot;value&quot;&gt;
      &lt;bean parent=&quot;RSACBridgeProxy&quot;&gt;
        &lt;property name=&quot;targetBeanName&quot; value=&quot;myRequestScopeBean&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
</pre>
<p>The AlterationWrapper implementing this interface is handed a Runnable (most likely an anonymous inner class) by RSF, holding all of the code which will be executed which might be expected to touch persistent state. The wrapper then invokes the Runnable, wraps by any bracketing code required by the persistence strategy for the framework. For example, a basic HibernateAlterationWrapper might look as follows:
</p>
<pre>
public class HibernateAlterationWrapper implements RunnableInvoker {
  private SessionFactory sessionfactory;
  public void setSessionFactory(SessionFactory sessionfactory) {
    this.sessionfactory = sessionfactory;
  }
...
  public void invokeRunnable(Runnable towrap) {
    try {
      Session session = sessionfactory.openSession();
      Transaction trans = session.beginTransaction();
      try {
        towrap.run();
        }
      catch (Exception e) {
        HibernateUtil.rollbackTransaction(transaction);
        throw UniversalRuntimeException.accumulate(e);
        }
      finally {
        HibernateUtil.closeSession(session);
        }
      }
    catch (Exception e) {
      throw UniversalRuntimeException.accumulate(e);
      }
    }
  }
</pre>
<p>Note:
</p>
<ul><li>The use of the <a class="wikipage" href="Wiki.jsp%3Fpage=UniversalRuntimeException.html">UniversalRuntimeException</a> here to avoid a polluted interface. This is one of the times when it really comes into its own.
</li><li>There are no threads being created here! We are just using Runnable as a convenient nullary single-method interface.
</li></ul><p>There are a number of benefits to this approach:
</p>
<ol><li>The AlterationWrapper is a perfectly normal bean and may be initialised, looked up and wired in in the normal way.
</li><li>The &quot;ideal case&quot; can be achieved for exception handling code - the <tt>try</tt>, <tt>catch</tt> and any <tt>finally</tt> block can all be visible in the same method body. This adds enormously to clarity and one's confidence in code robustness<a class="footnoteref" href="Wiki.jsp%3Fpage=AlterationWrapper.html#ref-AlterationWrapper-1">[1]</a>.
</li><li>Since this runnable is invoked &quot;fairly late&quot; in processing it could concievably benefit from more fine-grained information that RSF has about the current request (probably most critically, the ViewParameters).
</li><li>Mutual dependency between RSF, the ORM framework and application code is completely avoided. If you replace Hibernate or your transaction strategy, you simply wire a different AlterationWrapper into Spring.
</li></ol><p>Note that the traditional scheme for achieving this sort of cleanliness is <a class="wikipage" href="Wiki.jsp%3Fpage=AOP.html">AOP</a> - my analysis of the costs and benefits:
</p>
<ol><li>On the con side, this approach involves the creation of one extra object and two more function calls over the AOP, which my measurements place at somewhere below the 100ns mark with JDK 1.5 on modern hardware. Since this occurs once <i>per request</i> I think we could live with the cost.
</li><li>On the pro side, there is incredible reduction in anarchy of design, and we get an AOP-agnostic approach to request wrapping
</li></ol><p>Note that the AlterationWrapper might be considerably elaborate, for example if a really enterprising user were trying to apply an ORM-derived <a class="wikipage" href="Wiki.jsp%3Fpage=LongTransaction.html">long transaction</a> strategy to RSF, or completely empty if the request bean model implementing the data model took complete responsibility for transactional state.
</p>
<hr />
<a class="footnote" name="ref-AlterationWrapper-1">[#1]</a> Compare this to something like JSF's &quot;PhaseListener&quot; approach for example. JSF's exception handling policy is lamentably poor - in fact there isn't one, being one of the crucial drawbacks of the whole framework. Adding &quot;cleanup&quot; code that one wants to be <b>ABSOLUTELY SURE</b> will be executed to a particular JSF phase simply garners no confidence given the relevant code is rather messy and generally invisible. And, lo and behold, when I did so I frequently found that the cleanup code would fail to execute...<br />
<p />
<hr />
<span style="color: #666666; font-family: sans-serif; font-size:80%">You can post comments and questions on this page using the following blog. Please set your name using <a class="wikipage" href="Wiki.jsp%3Fpage=UserPreferences.html">UserPreferences</a> before posting.</span>
<div class="weblog">
</div>

<a href="NewBlogEntry.jsp%3Fpage=AlterationWrapper.html">New entry</a>







        
  </div>


  

  
  <div id="attach" class="hidetab" >

    










<div id="addattachment">
<h3>Add new attachment</h3>


<div class="formhelp">Only authorized users are allowed to upload new attachments.</div>

</div>



  </div>

  
    
  <div id="info" class="hidetab" >

  </div>

    
  

<div style="clear:both;" ></div>
</div>

      







<div id='actionsBottom' class="pageactions"> 
    

    <a href="Wiki.jsp%3Fpage=AlterationWrapper.html#top" 
      class="action quick2top" 
      title="Go to top" >&laquo;</a>

    
       This page (revision-) was last changed on <a href="Diff.jsp%3Fpage=AlterationWrapper&amp;r1=-1&amp;r2=1.html">22-Jun-2008 12:50</a> by UnknownAuthor
    

    

   

  

   
</div>

    </div>

    






<div id="favorites">

  






<div class="userbox">

  
    <span class="username anonymous">
      G&#8217;day (anonymous guest)
    </span>
  
  
  

  
  
  
    
      <a href="Login.jsp%3Fredirect=AlterationWrapper.html" 
        class="action login"
        title="Log in or Register as new user">Log in</a>
    
  
  
  
  

  
  
    <a href="UserPreferences.jsp%3Fredirect=AlterationWrapper.html"
      class="action prefs" accesskey="p"
      title="Manage your preferences [ p ]">My <span class='accesskey'>P</span>refs
    </a>
  
  

  <div class="clearbox"></div>

</div>
  
  <div id="hiddenmorepopup">
  <ul id="morepopup">
     
       	
     
       
     
    
       
     
       <li>
       
       <a class="action rawpage wikipage" 
               href="Wiki.jsp%3Fpage=AlterationWrapper&amp;skin=raw.html"
              title="View Page Source">View Page Source
       </a>
       
       
       </li>
      
        
  
      
      
      

      
	  <li class='separator'>
        <div id="moremenu" ></div>
      </li>
  </ul>
  </div>
  
  

  

  

  
  <div class="leftmenu">
    <p><a class="wikipage" href="Wiki.jsp%3Fpage=Main.html">Main page</a><br />
<tt> </tt><i><a class="wikipage" href="Wiki.jsp%3Fpage=ThisWiki.html">About</a></i><br />
</p><p><a class="wikipage" href="Wiki.jsp%3Fpage=GettingStarted.html">Getting Started</a><br />
</p>
<p><b>Documentation</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Developers.html">Developers</a><br />
<tt>  </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Javadocs.html">Javadocs</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Designers.html">Designers</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=SampleRSFApps.html">Sample RSF Apps</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Presentations.html">Presentations</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Acronyms.html">Acronyms</a><br />
</p>
<p><b>Downloads</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Downloads.html">Current Release</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=TrunkCode.html">Trunk</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=CodeDistributions.html">Distributions</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=OldCode.html">Old Versions</a><br />
</p>
<p><b>Community</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=QampA.html">Q&amp;A</a><br />
<tt> </tt><a class="external" href="http://ponder.org.uk/rsf/">Forums</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=EmailLists.html">Mailing Lists</a><br />
<tt> </tt><a class="external" href="http://www.caret.cam.ac.uk/jira/browse/RSF">Issue Tracker</a><img class="outlink" src="images/out.png" alt="" /><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=azeckoski.html">People</a><br />
</p>
<p><b>Design</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Roadmap.html">Roadmap</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Integrations.html">Integrations</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Concepts.html">Concepts</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=Philosophy.html">Philosophy</a><br />
</p>
<div style="font-style:italic;font-size:0.8em;">
<b>Pages</b><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=FindPage.html">Find</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=RecentChanges.html">Recent Changes</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=UnusedPages.html">Unused</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=UndefinedPages.html">Undefined</a><br />
<tt> </tt><a class="wikipage" href="Wiki.jsp%3Fpage=PageIndex.html">Index</a>
</div>
<p />
    
  </div>
  
  <div class="leftmenufooter">
    <hr />
<p><b>Referenced by</b><br />
<a class="wikipage" href="Wiki.jsp%3Fpage=Action.html">Action</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=ActionResultInterceptor.html">ActionResultIntercep...</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=BeanFetchBracketer.html">BeanFetchBracketer</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=LogonTest_3.html">LogonTest_3</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=Roadmap.html">Roadmap</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=UniversalRuntimeException.html">UniversalRuntimeExce...</a><br /><a class="wikipage" href="Wiki.jsp%3Fpage=ZigguratOfIntegration.html">ZigguratOfIntegratio...</a><br />
</p>
    
  </div>

  

  
  
  <div class="wikiversion">JSPWiki v2.8.2
  <span class="rssfeed">
    
  </span>
  </div>  
  
</div>

	<div class="clearbox"></div>
  </div>

  





 
<div id="footer">

  <div class="applicationlogo" > 
    <a href="Wiki.jsp%3Fpage=Main.html"
       title="Go to home page Main ">Home</a>
  </div>

  <div class="companylogo"></div>

  <div class="copyright"></div>

  <div class="wikiversion">
    JSPWiki v2.8.2
  </div>

  <div class="rssfeed">
    
  </div>

</div>

</div>

</body>
</html>

